–î–æ–±—Ä–µ, —Ç–µ–ø–µ—Ä –≤–∏–¥–Ω–æ —Ä–µ–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç üëç
–¢–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à **React + react-konva**, –∞ –Ω–µ ‚Äú—á–∏—Å—Ç–∏–π‚Äù Konva, —Ç–æ–º—É –ª–æ–≥—ñ–∫—É —Ç—Ä–µ–±–∞ –±—É–¥—É–≤–∞—Ç–∏ **—á–µ—Ä–µ–∑ —Å—Ç–∞–Ω React**, –±–µ–∑ –ø—Ä—è–º–æ–≥–æ `destroy()`.

–ù–∏–∂—á–µ ‚Äî **—Ä–æ–±–æ—á–∏–π, –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω** —Å–∞–º–µ –ø—ñ–¥ —Ç–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

---

## üéØ –©–æ —Ä–µ–∞–ª—ñ–∑—É—î–º–æ

‚úî –ö–ª—ñ–∫ –ø–æ **–µ–ª–µ–º–µ–Ω—Ç—É –∞–±–æ –ª—ñ–Ω—ñ—ó** ‚Üí –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è —ñ–∫–æ–Ω–∫–∞ **‚ãÆ**
‚úî –ö–ª—ñ–∫ –ø–æ **‚ãÆ** ‚Üí –º–µ–Ω—é **¬´–í–∏–¥–∞–ª–∏—Ç–∏¬ª**
‚úî **–í–∏–¥–∞–ª–∏—Ç–∏**:

* –¥–ª—è **–ª—ñ–Ω—ñ—ó** ‚Üí –≤–∏–¥–∞–ª—è—î –ª—ñ–Ω—ñ—é
* –¥–ª—è **–µ–ª–µ–º–µ–Ω—Ç–∞** ‚Üí –≤–∏–¥–∞–ª—è—î –µ–ª–µ–º–µ–Ω—Ç **+ –≤—Å—ñ –ª—ñ–Ω—ñ—ó, —â–æ –¥–æ –Ω—å–æ–≥–æ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω—ñ**
  ‚úî –û–¥–∏–Ω –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è **–µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —ñ –∑–≤ º—è–∑–∫—ñ–≤**

---

## üß† –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —ñ–¥–µ—è (–í–ê–ñ–õ–ò–í–û)

–£ React-Konva **–ù–ï –ú–û–ñ–ù–ê**:

* —Ä–æ–±–∏—Ç–∏ `node.destroy()`
* –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —Å—Ü–µ–Ω–æ—é –Ω–∞–ø—Ä—è–º—É

‚ùó –í—Å–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è ‚Äî **—á–µ—Ä–µ–∑ state**:

```txt
State ‚Üí render ‚Üí Konva
```

---

## 1Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```js
elements = [
  { id: 'n1', x: 100, y: 100 }
]

lines = [
  {
    id: 'l1',
    fromId: 'n1',
    toId: 'n2',
    points: [x1, y1, x2, y2]
  }
]
```

‚ùó `fromId / toId` ‚Äî –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ

---

## 2Ô∏è‚É£ –û–≤–µ—Ä–ª–µ–π ¬´‚ãÆ + –º–µ–Ω—é¬ª (UI layer)

### `GraphContextMenu.jsx`

```jsx
import { Group, Rect, Text } from 'react-konva';

export default function GraphContextMenu({ x, y, onDelete }) {
  return (
    <Group x={x} y={y}>
      <Rect
        width={120}
        height={36}
        fill="white"
        cornerRadius={8}
        shadowBlur={8}
      />
      <Text
        text="–í–∏–¥–∞–ª–∏—Ç–∏"
        fill="#b91c1c"
        fontSize={14}
        x={10}
        y={9}
        onClick={onDelete}
      />
    </Group>
  );
}
```

---

## 3Ô∏è‚É£ –Ü–∫–æ–Ω–∫–∞ ¬´‚ãÆ¬ª

```jsx
const DotsIcon = ({ x, y, onClick }) => (
  <Text
    text="‚ãÆ"
    x={x}
    y={y}
    fontSize={18}
    fill="white"
    padding={6}
    background="#111827"
    onClick={onClick}
  />
);
```

---

## 4Ô∏è‚É£ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –≤–∏–¥–∞–ª–µ–Ω–Ω—è (–æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞)

### `useGraphDelete.js`

```js
export function deleteNodeWithLinks(nodeId, elements, lines) {
  return {
    elements: elements.filter(el => el.id !== nodeId),
    lines: lines.filter(
      l => l.fromId !== nodeId && l.toId !== nodeId
    )
  };
}

export function deleteLine(lineId, lines) {
  return lines.filter(l => l.id !== lineId);
}
```

---

## 5Ô∏è‚É£ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ Graph (–∫–ª—é—á–æ–≤–µ)

### `Graph.jsx`

```jsx
const [elements, setElements] = useState([]);
const [lines, setLines] = useState([]);

const [selected, setSelected] = useState(null);
// selected = { type: 'node' | 'line', id, x, y }

const handleDelete = () => {
  if (!selected) return;

  if (selected.type === 'node') {
    const res = deleteNodeWithLinks(selected.id, elements, lines);
    setElements(res.elements);
    setLines(res.lines);
  }

  if (selected.type === 'line') {
    setLines(deleteLine(selected.id, lines));
  }

  setSelected(null);
};
```

---

## 6Ô∏è‚É£ –û–Ω–æ–≤–ª–µ–Ω–∏–π `LineElement` (—Ç–≤—ñ–π —Ñ–∞–π–ª)

### `app/component/graph/lineElement.js`

```jsx
import { Line } from 'react-konva';

const LineElement = ({ el, onSelect }) => {
  return (
    <Line
      points={el.points}
      stroke="black"
      strokeWidth={2}
      draggable
      onClick={(e) => {
        const pos = e.target.getStage().getPointerPosition();
        onSelect(pos.x, pos.y, {
          type: 'line',
          id: el.id
        });
      }}
    />
  );
};

export default LineElement;
```

---

## 7Ô∏è‚É£ –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–ª—è –µ–ª–µ–º–µ–Ω—Ç–∞ (node)

```jsx
onClick={(e) => {
  const pos = e.target.getStage().getPointerPosition();
  onSelect(pos.x, pos.y, {
    type: 'node',
    id: el.id
  });
}}
```

---

## 8Ô∏è‚É£ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è UI

```jsx
{selected && (
  <>
    <DotsIcon
      x={selected.x}
      y={selected.y}
      onClick={() => setMenuOpen(true)}
    />

    {menuOpen && (
      <GraphContextMenu
        x={selected.x}
        y={selected.y + 24}
        onDelete={handleDelete}
      />
    )}
  </>
)}
```

---

## üî• –ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

‚úÖ **React-friendly**
‚úÖ –õ–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏:

* ¬´–ö–æ–ø—ñ—é–≤–∞—Ç–∏¬ª
* ¬´–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ¬ª
* ¬´–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏¬ª
* undo / redo
  ‚úÖ –ü—Ä–∞—Ü—é—î –æ–¥–Ω–∞–∫–æ–≤–æ –¥–ª—è **–µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —ñ –∑–≤ º—è–∑–∫—ñ–≤**
  ‚úÖ –ù–µ –ª–∞–º–∞—î—Ç—å—Å—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–µ–Ω–¥–µ—Ä-–∫–æ–¥—É (—Ç–≤—ñ–π —Å—Ç—Ä–∞—Ö —ñ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)

---

## üöÄ –•–æ—á–µ—à –¥–∞–ª—ñ?

–ú–æ–∂—É:

1. –î–æ–¥–∞—Ç–∏ **undo / redo**
2. –ó—Ä–æ–±–∏—Ç–∏ **multi-select**
3. –î–æ–¥–∞—Ç–∏ **hotkey Delete**
4. –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ü–µ –≤ **Oracle JSON / CLOB**
5. –ê–¥–∞–ø—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ **viewer / editor mode**

–°–∫–∞–∂–∏, –∫—É–¥–∏ —Ä—É—Ö–∞—î–º–æ—Å—å üëç
