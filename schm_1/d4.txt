–ß—É–¥–æ–≤–æ, —Ç–æ–¥—ñ —Ä–æ–±–∏–º–æ **–∞–∫—É—Ä–∞—Ç–Ω–∏–π editor-style —Ö—É–∫**, —è–∫–∏–π:

* **–ø—ñ–¥ —á–∞—Å –ø–∞–Ω–æ—Ä–∞–º—É–≤–∞–Ω–Ω—è (MMB –∞–±–æ Space+LMB)**
  üîí —Ç–∏–º—á–∞—Å–æ–≤–æ **–≤–∏–º–∏–∫–∞—î `draggable` —É –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤**
* **–ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–∞–Ω—É**
  üîì **–ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω draggable** (–Ω–µ –ø—Ä–æ—Å—Ç–æ `true`, –∞ —Å–∞–º–µ —è–∫ –±—É–ª–æ)

–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ö–µ–º (Konva + —Ä–µ–¥–∞–∫—Ç–æ—Ä).

---

## üéØ –Ü–¥–µ—è (–∫–æ—Ä–æ—Ç–∫–æ)

1. –ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –ø–∞–Ω–æ—Ä–∞–º—É–≤–∞–Ω–Ω—è:

   * –æ–±—Ö–æ–¥–∏–º–æ –≤—Å—ñ –Ω–æ–¥–∏ —É `layer`
   * –∑–±–µ—Ä—ñ–≥–∞—î–º–æ `draggable()` —É `Map`
   * —Å—Ç–∞–≤–∏–º–æ `draggable(false)`
2. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:

   * –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ `Map`

---

## ‚úÖ –•—É–∫: `useDisableDraggableWhilePanning`

> **–ü—Ä–∞—Ü—é—î —ñ –≤ —á–∏—Å—Ç–æ–º—É JS, —ñ –≤ React/Next.js**

```js
/**
 * –¢–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∏–∫–∞—î draggable —É –≤—Å—ñ—Ö –Ω–æ–¥ layer –ø—ñ–¥ —á–∞—Å –ø–∞–Ω–æ—Ä–∞–º—É–≤–∞–Ω–Ω—è.
 * –ö–æ—Ä–µ–∫—Ç–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª—é—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞.
 */
export function createDraggableLock(layer) {
  if (!layer) throw new Error("layer is required");

  const prevState = new Map();
  let locked = false;

  function lock() {
    if (locked) return;
    locked = true;

    prevState.clear();

    layer.find("*").each((node) => {
      // —Ç—ñ–ª—å–∫–∏ —Ç—ñ, –¥–µ draggable –º–∞—î —Å–µ–Ω—Å
      if (typeof node.draggable === "function") {
        prevState.set(node._id, node.draggable());
        node.draggable(false);
      }
    });
  }

  function unlock() {
    if (!locked) return;
    locked = false;

    layer.find("*").each((node) => {
      if (!prevState.has(node._id)) return;
      node.draggable(prevState.get(node._id));
    });

    prevState.clear();
  }

  function destroy() {
    prevState.clear();
  }

  return {
    lock,
    unlock,
    destroy,
  };
}
```

---

## üîå –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Ç–≤–æ—ó–º `setupLayerZoomPan`

### –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∫–∏ (–ø–æ–∫–∞–∑—É—é –ª–∏—à–µ —Ä—ñ–∑–Ω–∏—Ü—é)

```js
import { createDraggableLock } from "./createDraggableLock";

const draggableLock = createDraggableLock(layer);

// —É onMouseDown (–∫–æ–ª–∏ —Å—Ç–∞—Ä—Ç—É—î –ø–∞–Ω)
function onMouseDown(e) {
  const evt = e.evt;
  if (!canStartPan(evt)) return;

  draggableLock.lock();   // üîí
  isPanning = true;
  lastClient = { x: evt.clientX, y: evt.clientY };
  container.style.cursor = "grabbing";
  evt.preventDefault();
}

// —É stopPan
function stopPan() {
  if (!isPanning) return;

  isPanning = false;
  lastClient = null;
  draggableLock.unlock(); // üîì

  container.style.cursor = spaceDown ? "grab" : "default";
}
```

> ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ: `unlock()` –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **—É –≤—Å—ñ—Ö exit-—Ç–æ—á–∫–∞—Ö** (`mouseup`, `mouseleave`, `destroy`)

---

## üß† –ß–æ–º—É —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

* ‚ùå **–ù–µ –ª–∞–º–∞—î** drag-–ª–æ–≥—ñ–∫—É –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
* ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î **—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω** –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
* üö´ –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥–ª–æ–±–∞–ª—å–Ω—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ —Ç–∏–ø—É `stage.draggable(false)`
* ‚öôÔ∏è –ü—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–æ—é —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é —Å—Ü–µ–Ω–∏

---

## üß™ –ë–æ–Ω—É—Å: —Ñ—ñ–ª—å—Ç—Ä (—è–∫—â–æ –Ω–µ —Ö–æ—á–µ—à –≤–∏–º–∏–∫–∞—Ç–∏ draggable —É –≤—Å—ñ—Ö)

–ú–æ–∂–µ—à –æ–±–º–µ–∂–∏—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç—ñ–ª—å–∫–∏ `Shape` –∞–±–æ `Group`:

```js
layer.find("Shape, Group").each(...)
```

–∞–±–æ —Ç—ñ–ª—å–∫–∏ —Ç—ñ, —â–æ –º–∞—é—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É –æ–∑–Ω–∞–∫—É:

```js
if (node.getAttr("editorDraggable")) {
  ...
}
```

---

## üîö –ü—ñ–¥—Å—É–º–æ–∫

–¢–µ–ø–µ—Ä —É —Ç–µ–±–µ:

* Zoom + pan —è–∫ —É –≥—Ä–∞—Ñ—ñ—á–Ω–æ–º—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—ñ
* –ë–µ–∑ ‚Äú–ø—Ä–∏–ª–∏–ø–∞–Ω–Ω—è‚Äù –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
* –ü–æ–≤–Ω—ñ—Å—Ç—é –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π UX

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ª–æ–≥—ñ—á–Ω–∏–π –∫—Ä–æ–∫:
üëâ **zoom-to-fit (–≤–ø–∏—Å–∞—Ç–∏ —Å—Ö–µ–º—É –≤ –µ–∫—Ä–∞–Ω)**
üëâ **–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—ñ—Ç–∫–∞ + snap –ø—Ä–∏ drag**
üëâ **undo/redo (history)**
