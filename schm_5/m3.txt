–ö–æ—Ä–æ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: **—Ç–∞–∫, –Ω–µ–≤–µ–ª–∏–∫–µ ‚Äú–ø—Ä–∏–≥–∞–ª—å–º–æ–≤—É–≤–∞–Ω–Ω—è‚Äù –ø—Ä–∏ –≤–≤—ñ–º–∫–Ω–µ–Ω–æ–º—É grid ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–µ**, –∞–ª–µ **–π–æ–≥–æ –º–æ–∂–Ω–∞ —ñ —Ç—Ä–µ–±–∞ –∑–º–µ–Ω—à–∏—Ç–∏**. –Ø–∫—â–æ –≤–æ–Ω–æ –ø–æ–º—ñ—Ç–Ω–µ ‚Äú–Ω–∞ –æ–∫–æ‚Äù ‚Äî –∑–Ω–∞—á–∏—Ç—å –∑–∞—Ä–∞–∑ grid —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –Ω–µ –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ.

–ù–∏–∂—á–µ ‚Äî —á—ñ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è **—á–æ–º—É —Ü–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è** —ñ **—è–∫ –∑—Ä–æ–±–∏—Ç–∏, —â–æ–± —Ä—É—Ö –±—É–≤ –º–∞–π–∂–µ —è–∫ –±–µ–∑ grid** (—è–∫ —É Visio / Figma).

---

## –ß–æ–º—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–≥–∞–ª—å–º–æ–≤—É—î —Å–∞–º–µ –∑ grid

### 1Ô∏è‚É£ Grid = –±–∞–≥–∞—Ç–æ Line-–æ–±‚Äô—î–∫—Ç—ñ–≤

–ù–∞–≤—ñ—Ç—å ‚Äú–ø—Ä–æ—Å—Ç–∏–π‚Äù grid ‚Äî —Ü–µ:

* –¥–µ—Å—è—Ç–∫–∏ –∞–±–æ **—Å–æ—Ç–Ω—ñ `<Line />`**
* —è–∫—ñ **–ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—é—Ç—å—Å—è** –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É `dragmove`

Konva –ø—Ä–∏ drag:

* –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î hit-graph
* –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—É—î layer
* –æ–Ω–æ–≤–ª—é—î transform

üëâ –ö–æ–ª–∏ grid —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π, **—Ä–µ–Ω–¥–µ—Ä –≤–∞–∂—á–∏–π**.

---

### 2Ô∏è‚É£ Grid –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–∞–∑–æ–º —ñ–∑ drag

–ù–∞–π—á–∞—Å—Ç—ñ—à–∞ –ø–æ–º–∏–ª–∫–∞ (—ñ —è –±–∞—á—É, —â–æ –≤ —Ç–µ–±–µ –≤–æ–Ω–∞ –º–∞–π–∂–µ —Ç–æ—á–Ω–æ —î):

> ‚ùå Grid –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è / –ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î—Ç—å—Å—è **–ø—ñ–¥ —á–∞—Å drag –µ–ª–µ–º–µ–Ω—Ç–∞**

–ê –º–∞—î –±—É—Ç–∏:

> ‚úÖ Grid –∑–º—ñ–Ω—é—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ zoom / pan / resize**,
> ‚ùå **–ù–ï** –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É `dragmove`.

---

### 3Ô∏è‚É£ Snap + Grid = –ø–æ–¥–≤—ñ–π–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

–ü—ñ–¥ —á–∞—Å drag —É —Ç–µ–±–µ –æ–¥–Ω–æ—á–∞—Å–Ω–æ:

* `computeSnap()` (getClientRect, –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è)
* * grid layer –∞–∫—Ç–∏–≤–Ω–∏–π
* * guides layer

–¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∞–ª–µ **—Ç—Ä–µ–±–∞ —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ**.

---

## –Ø–∫ –∑—Ä–æ–∑—É–º—ñ—Ç–∏: ‚Äú–Ω–æ—Ä–º–∞‚Äù —á–∏ ‚Äú–ø–æ–≥–∞–Ω–æ‚Äù

–û—Ä—ñ—î–Ω—Ç–∏—Ä:

| –ü–æ–≤–µ–¥—ñ–Ω–∫–∞                          | –û—Ü—ñ–Ω–∫–∞                  |
| ---------------------------------- | ----------------------- |
| –õ–µ–¥—å –≤—ñ–¥—á—É—Ç–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è vs –±–µ–∑ grid  | ‚úÖ –ù–æ—Ä–º–∞                 |
| –í—ñ–¥—á—É—Ç–Ω—ñ ‚Äú—Ä–∏–≤–∫–∏‚Äù –ø—Ä–∏ drag          | ‚ö†Ô∏è –ü–æ—Ç—Ä—ñ–±–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è |
| Drag —Å—Ç–∞—î ‚Äú–ª–∏–ø–∫–∏–º‚Äù –∞–±–æ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é | ‚ùå –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ |

---

## 5 –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–ò–• –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π (–ø–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É)

### ‚úÖ 1. Grid **–Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–∞—î —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ drag –µ–ª–µ–º–µ–Ω—Ç—ñ–≤**

–ü–µ—Ä–µ–≤—ñ—Ä:

* ‚ùå `setGridLines(...)` —É `onDragMove`
* ‚ùå –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å `useGrid()` –≤—ñ–¥ –ø–æ–∑–∏—Ü—ñ–π –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

Grid –º–∞—î –∑–∞–ª–µ–∂–∞—Ç–∏ **–¢–Ü–õ–¨–ö–ò** –≤—ñ–¥:

* scale
* position (pan)
* stage size
* gridSize

üëâ –Ø–∫—â–æ grid –º—ñ–Ω—è—î—Ç—å—Å—è –ø—Ä–∏ drag ‚Äî —Ü–µ –≥–æ–ª–æ–≤–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –ª–∞–≥—ñ–≤.

---

### ‚úÖ 2. GridLayer ‚Üí `listening={false}`

–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ:

```jsx
<Layer listening={false}>
```

–¶–µ:

* –≤–∏–º–∏–∫–∞—î hit-detection
* –∑–º–µ–Ω—à—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ drag **–≤ —Ä–∞–∑–∏**

---

### ‚úÖ 3. Memo + static lines

–£ `GridLayer`:

```js
const lines = useMemo(() => buildGridLines(...), [
  width,
  height,
  scale,
  offsetX,
  offsetY,
  gridSize,
]);
```

‚ùå **–ù–ï** –¥–æ–¥–∞–≤–∞–π —É deps:

* position –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
* selection
* hoveredElement

---

### ‚úÖ 4. Grid —É —Ç–æ–º—É –∂ world-transform, —â–æ —ñ –µ–ª–µ–º–µ–Ω—Ç–∏

–¢–µ, –ø—Ä–æ —â–æ –º–∏ –≥–æ–≤–æ—Ä–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ:

**–ö—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:**

```jsx
<Layer ref={worldLayerRef}>
  <GridLayer />   {/* listening=false */}
  <Elements />
</Layer>
```

–¢–æ–¥—ñ:

* Konva —Ä–æ–±–∏—Ç—å **–æ–¥–∏–Ω transform**
* grid **–Ω–µ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è**
* GPU –ø—Ä–∞—Ü—é—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–µ

üëâ –¶–µ —Ä–µ–∞–ª—å–Ω–æ –¥–∞—î +30‚Äì50% –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ.

---

### ‚úÖ 5. –ü—ñ–¥ —á–∞—Å drag –º–æ–∂–Ω–∞ ‚Äú–ø–æ–ª–µ–≥—à—É–≤–∞—Ç–∏‚Äù grid (Visio-—Å—Ç–∏–ª—å)

–ü—Ä–æ—Ñ. —Ä–µ–¥–∞–∫—Ç–æ—Ä–∏ —Ç–∞–∫ —Ä–æ–±–ª—è—Ç—å:

* –ø—ñ–¥ —á–∞—Å drag:

  * ‚ùå —Ç–æ–Ω–∫—ñ –ª—ñ–Ω—ñ—ó
  * ‚ùå subGrid
* –∑–∞–ª–∏—à–∞—é—Ç—å —Ç—ñ–ª—å–∫–∏:

  * –æ—Å–Ω–æ–≤–Ω—ñ –ª—ñ–Ω—ñ—ó
  * –∞–±–æ –≤–∑–∞–≥–∞–ª—ñ –ø—Ä–∏—Ö–æ–≤—É—é—Ç—å grid

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Å—Ç–∞:

```js
onDragStart ‚Üí setGridMode("light")
onDragEnd   ‚Üí setGridMode("full")
```

---

## –Ø–∫ –º–∞—î –≤–∏–≥–ª—è–¥–∞—Ç–∏ ‚Äú—ñ–¥–µ–∞–ª—å–Ω–æ‚Äù (—è–∫ —É Visio)

| –°—Ç–∞–Ω         | Grid                    |
| ------------ | ----------------------- |
| Idle         | –ü–æ–≤–Ω–∏–π                  |
| Zoom / Pan   | –ü–æ–≤–Ω–∏–π                  |
| Drag element | –°–ø—Ä–æ—â–µ–Ω–∏–π –∞–±–æ –≤–∏–º–∫–Ω–µ–Ω–∏–π |
| Drag + Snap  | Grid + Guides           |

–¶–µ **–Ω–µ –∫–æ—Å—Ç–∏–ª—å**, —Ü–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç UX.

---

## –ö–æ—Ä–æ—Ç–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (–∑—Ä–æ–±–∏ –∑–∞—Ä–∞–∑)

–°–ø—Ä–æ–±—É–π —Ç–∏–º—á–∞—Å–æ–≤–æ:

```jsx
// —É GridLayer
return showGrid && !isDragging ? <GridLayer /> : null;
```

–Ø–∫—â–æ drag —Å—Ç–∞–≤ **—Ä—ñ–∑–∫–æ –ø–ª–∞–≤–Ω–∏–º** ‚Äî –∑–Ω–∞—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ —É grid rendering, –Ω–µ —É snap.

---

## –í–∏—Å–Ω–æ–≤–æ–∫

‚úî –¢–∞–∫, **–ª–µ–≥–∫–µ –ø—Ä–∏–≥–∞–ª—å–º–æ–≤—É–≤–∞–Ω–Ω—è ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–µ**
‚ùå –í—ñ–¥—á—É—Ç–Ω–µ ‚Äî **–Ω–µ –Ω–æ—Ä–º–∞**, –∞ –æ–∑–Ω–∞–∫–∞ —â–æ grid:

* –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ
* –∞–±–æ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É layer
* –∞–±–æ —Å–ª—É—Ö–∞—î –ø–æ–¥—ñ—ó

---

### –ù–∞—Å—Ç—É–ø–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∫—Ä–æ–∫–∏

–Ø —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –¥–∞–ª—ñ (—É —Ç–∞–∫–æ–º—É –ø–æ—Ä—è–¥–∫—É):

1. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ grid **–≤ world-layer**
2. –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ `buildGridLines` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ zoom/pan**
3. –ó—Ä–æ–±–∏—Ç–∏ ‚Äúlight grid while dragging‚Äù
4. –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ snap (–∫–µ—à—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ `dragstart`)

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî —Å–∫–∏–Ω—å:

* `useGrid.js`
* –¥–µ —Å–∞–º–µ —Ç–∏ –≤–∏–∫–ª–∏–∫–∞—î—à `buildGridLines`
* —á–∏ grid –∑–∞—Ä–∞–∑ –≤ –æ–∫—Ä–µ–º–æ–º—É Layer

—ñ —è –¥–∞–º **—Ç–æ—á–∫–æ–≤–∏–π –ø–∞—Ç—á**, –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏.
