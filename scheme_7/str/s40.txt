–û–∫, —Ç–µ–ø–µ—Ä **—Ç–æ—á–Ω–æ —Ç–µ** üôÇ
–¢–∏ —Å–∫–∏–Ω—É–≤: **`auth.js` (—Å—Ç–∞—Ä–∏–π —à–ª—è—Ö `utils/auth.js`)**. –¶–µ **—Å–µ—Ä–≤–µ—Ä–Ω–∞ —É—Ç–∏–ª—ñ—Ç–∞ –¥–ª—è logout –≤ middleware/route-handlers**, —Ç–æ–º—É —ó—ó –∫—Ä–∞—â–µ –≤–∏–Ω–µ—Å—Ç–∏ –≤ **shared/auth** (–±–æ —Ü–µ –Ω–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è scheme-editor).

---

## 1) –ö—É–¥–∏ –∫–ª–∞—Å—Ç–∏ –≤ –Ω–æ–≤—ñ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ

‚úÖ –ù–æ–≤–∏–π —à–ª—è—Ö:

```
src/shared/auth/logoutUser.js
```

(–ù–∞–∑–≤—É —Ñ–∞–π–ª—É —Ä–æ–±–ª—é –±—ñ–ª—å—à –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—é, –∞–ª–µ —è–∫—â–æ —Ö–æ—á–µ—à 1:1 ‚Äî –º–æ–∂–Ω–∞ `src/shared/auth/auth.js`.)

---

## 2) –ó—ñ–±—Ä–∞–Ω–∏–π —Ñ–∞–π–ª (1:1 –∑—ñ —Å–∫—Ä—ñ–Ω—ñ–≤) ‚Äî `logoutUser.js`

```js
import { NextResponse } from "next/server";

export async function logoutUser(req) {
  const { pathname } = req.nextUrl;

  // –Ø–∫—â–æ —Ü–µ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ª–æ–≥—ñ–Ω, —Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞—î–º–æ cookies (—â–æ–± –Ω–µ –±—É–ª–æ —Ä–µ–∫—É—Ä—Å—ñ—ó)
  if (pathname === "/login") {
    return NextResponse.next({
      headers: {
        "Set-Cookie": [
          "accessTokenEtls=; HttpOnly; Path=/; Max-Age=0",
          "refreshTokenEtls=; HttpOnly; Path=/; Max-Age=0",
          "accessToken=; HttpOnly; Path=/; Max-Age=0",
          "refreshToken=; HttpOnly; Path=/; Max-Age=0",
          "etlsUser=; HttpOnly; Path=/; Max-Age=0",
        ].join(", "),
      },
    });
  } else {
    try {
      // –í–∏–∫–æ–Ω—É—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ nextjs api logout
      const logoutOnServerAPI = await fetch(
        `${req.nextUrl.origin}/api/rest/logoutrest`,
        {
          method: "POST",
          credentials: "include",
          headers: {
            "Content-Type": "application/json",
            Cookie: req.headers.get("cookie") || "",
          },
        },
      );

      if (!logoutOnServerAPI.ok) {
        console.error(
          "Failed to logout on remote API, proceeding with local logout.",
        );
      }

      console.info(
        "User logged out successfully from API, clearing cookies...",
      );

      // –û—á–∏—â–∞—î–º–æ cookies —ñ —Ä–æ–±–∏–º–æ —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ /login
      return NextResponse.redirect(new URL("/login", req.url), {
        headers: {
          "Set-Cookie": [
            "accessTokenEtls=; HttpOnly; Path=/; Max-Age=0",
            "refreshTokenEtls=; HttpOnly; Path=/; Max-Age=0",
            "userDataEtls=; HttpOnly; Path=/; Max-Age=0",
            "etlsUser=; HttpOnly; Path=/; Max-Age=0",
            "accessToken=; HttpOnly; Path=/; Max-Age=0",
            "refreshToken=; HttpOnly; Path=/; Max-Age=0",
          ].join(", "),
        },
      });
    } catch (error) {
      console.error("Logout error:", error);

      // –£ —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ –≤—Å–µ –æ–¥–Ω–æ –æ—á–∏—â–∞—î–º–æ cookies —ñ —Ä–æ–±–∏–º–æ —Ä–µ–¥—ñ—Ä–µ–∫—Ç
      return NextResponse.redirect(new URL("/login", req.url), {
        headers: {
          "Set-Cookie": [
            "accessTokenEtls=; HttpOnly; Path=/; Max-Age=0",
            "refreshTokenEtls=; HttpOnly; Path=/; Max-Age=0",
            "userDataEtls=; HttpOnly; Path=/; Max-Age=0",
            "etlsUser=; HttpOnly; Path=/; Max-Age=0",
            "accessToken=; HttpOnly; Path=/; Max-Age=0",
            "refreshToken=; HttpOnly; Path=/; Max-Age=0",
          ].join(", "),
        },
      });
    }
  }
}
```

---

## 3) –Ø–∫ –º—ñ–Ω—è—î—Ç—å—Å—è —ñ–º–ø–æ—Ä—Ç —É –∫–æ–¥—ñ

–ë—É–ª–æ:

```js
import { logoutUser } from "@/utils/auth";
```

–°—Ç–∞—î:

```js
import { logoutUser } from "@/shared/auth/logoutUser";
```

---

## 4) –ú–∞–ª–µ–Ω—å–∫–∞ (–∞–ª–µ –≤–∞–∂–ª–∏–≤–∞) —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è

–¢–∏ —Ä–æ–±–∏—à `"Set-Cookie": [...].join(", ")`.
–£ Next/Edge —Ü–µ **—ñ–Ω–∫–æ–ª–∏** –ø—Ä–∞—Ü—é—î, –∞–ª–µ –±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–æ ‚Äî –≤–∏—Å—Ç–∞–≤–ª—è—Ç–∏ cookies —á–µ—Ä–µ–∑ `response.cookies.set(...)`.
–Ø **–Ω–µ –º—ñ–Ω—è—é –∑–∞—Ä–∞–∑**, –±–æ —Ç–∏ –ø—Ä–æ—Å–∏–≤ ‚Äú–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏‚Äù —è–∫ —î, –∞–ª–µ —è–∫—â–æ –≤ —Ç–µ–±–µ –¥–µ—Å—å ‚Äú–Ω–µ —á–∏—Å—Ç—è—Ç—å—Å—è –∫—É–∫—ñ‚Äù ‚Äî —Ü–µ –ø–µ—Ä—à–∞ –ø—Ä–∏—á–∏–Ω–∞.

---

–ö–∏–¥–∞–π –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ñ–∞–π–ª –∑—ñ —Å—Ç–∞—Ä–æ–≥–æ `utils/` (–∞–±–æ –º—ñ—Å—Ü–µ, –¥–µ `logoutUser()` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è ‚Äî middleware), —ñ —è –æ–¥—Ä–∞–∑—É –ø—ñ–¥–∫–∞–∂—É –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö/–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤ –Ω–æ–≤—ñ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ.
