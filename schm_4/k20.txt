–ß—É–¥–æ–≤–æ, —Ç–µ–ø–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç **GraphLibrary** –ø–æ–≤–Ω—ñ—Å—Ç—é –∑—Ä–æ–∑—É–º—ñ–ª–∏–π üëç
–¢–∏ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –≤–∂–µ –ø—Ä–∏–π—à–æ–≤ –¥–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ç–µ—Ä–Ω—É**, –ø—Ä–æ—Å—Ç–æ –π–æ–≥–æ —Ç—Ä–µ–±–∞ —Ç—Ä–æ—Ö–∏ ¬´–¥–æ–¥–∏—Å—Ü–∏–ø–ª—ñ–Ω—É–≤–∞—Ç–∏¬ª, —â–æ–± –≤—ñ–Ω –¥–æ–±—Ä–µ –ª—ñ–≥ —É FSD-–ø–æ–¥—ñ–±–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —ñ –Ω–µ —Ä–æ–∑–≤–∞–ª–∏–≤—Å—è —á–µ—Ä–µ–∑ –ø—ñ–≤ —Ä–æ–∫—É.

–ù–∏–∂—á–µ ‚Äî **—á—ñ—Ç–∫–æ —ñ –ø–æ –∫—Ä–æ–∫–∞—Ö**.

---

## 1Ô∏è‚É£ –©–æ —Ç–∞–∫–µ GraphLibrary —É —Ç–≤–æ—ó–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—ñ (—ñ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

–¢–µ, —â–æ —Ç–∏ –æ–ø–∏—Å–∞–≤:

> GraphLibrary ‚Äî —Ñ–∞–π–ª, –¥–µ –ø—ñ–¥–∫–ª—é—á–∞—é—Ç—å—Å—è —É—Å—ñ –≥—Ä–∞—Ñ—ñ—á–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —è–∫—ñ **–¥–æ–∑–≤–æ–ª–µ–Ω—ñ** –¥–ª—è –≤—ñ–¥–º–∞–ª—å–æ–≤–∫–∏

üëâ –¶–µ **registry / factory**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ index.

–¶–µ:

* –Ω–µ UI —Å—Ç–æ—Ä—ñ–Ω–∫–∏
* –Ω–µ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
* –Ω–µ diagram-state
* **—Ü–µ shared layer**

‚úî –ê–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ —ñ–¥–µ—è.

---

## 2Ô∏è‚É£ –î–µ GraphLibrary –º–∞—î –∂–∏—Ç–∏

### ‚ùå –ù–ï —Ç—É—Ç

```
features/diagram-editor/graph
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û

```
src/shared/diagram/shapes/
  Rect/
    RectShape.js
    index.js
  Circle/
    CircleShape.js
    index.js
  Text/
    TextShape.js
    index.js
  Line/
    LineShape.js
    index.js
  Symbol1/
    Symbol1Shape.js
    index.js

  registry.js        ‚Üê —Ç–≤—ñ–π GraphLibrary
  index.js
```

> –ß–æ–º—É `shared/diagram/shapes`, –∞ –Ω–µ `shared/konva`?
> –ë–æ —Ü–µ **–¥–æ–º–µ–Ω–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ø—Ä–∏–º—ñ—Ç–∏–≤–∏ —Å—Ö–µ–º–∏**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ Konva-—É—Ç–∏–ª—ñ—Ç–∏ (—è–∫ zoom/selection).

---

## 3Ô∏è‚É£ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–∏–≤–∞—Ç–∏: –ù–ï `Rect`, –∞ `RectShape`

### –ß–æ–º—É?

* `Rect` ‚Äî —Ü–µ konva primitive
* `RectElement` ‚Äî UI-—Ç–µ—Ä–º—ñ–Ω
* —É —Ç–µ–±–µ —Ü–µ **–¥–æ–º–µ–Ω–Ω–∞ —Ñ—ñ–≥—É—Ä–∞ —Å—Ö–µ–º–∏**

üëâ –¢–æ–º—É: `RectShape`, `CircleShape`, `LineShape`

---

## 4Ô∏è‚É£ –Ø–∫ –≤–∏–≥–ª—è–¥–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π `registry.js` (GraphLibrary)

### `shared/diagram/shapes/registry.js`

```js
import { RectShape } from "./Rect";
import { CircleShape } from "./Circle";
import { TextShape } from "./Text";
import { LineShape } from "./Line";
import { Symbol1Shape } from "./Symbol1";

/**
 * Registry –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö shape
 * key === el.type
 */
export const ShapeRegistry = {
  rect: RectShape,
  circle: CircleShape,
  text: TextShape,
  line: LineShape,
  symbol1: Symbol1Shape,
};
```

### `shared/diagram/shapes/index.js`

```js
export { ShapeRegistry } from "./registry";
```

---

## 5Ô∏è‚É£ –¢–≤—ñ–π Rect.js ‚Äî —â–æ –≤ –Ω—å–æ–º—É —Ç—Ä–µ–±–∞ –ø–æ–ø—Ä–∞–≤–∏—Ç–∏

### ‚ùå –ë—É–ª–æ

```js
const RectElement = ({ el }) => {
  return (
    <Rect
      x={0}
      y={0}
      width={el.width}
      height={el.height}
      fill={el.fill}
      stroke={el.stroke}
      strokeWidth={el.strokeWidth}
    />
  );
};
```

### ‚úÖ –°—Ç–∞–ª–æ (`RectShape.js`)

```js
import React from "react";
import { Rect } from "react-konva";

export function RectShape({ el }) {
  return (
    <Rect
      x={0}
      y={0}
      width={el.width}
      height={el.height}
      fill={el.fill}
      stroke={el.stroke}
      strokeWidth={el.strokeWidth}
      listening={true}
    />
  );
}
```

> üîë **–í–ê–ñ–õ–ò–í–û:**

* `x=0,y=0` ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –±–æ –ø–æ–∑–∏—Ü—ñ—é —Ç—Ä–∏–º–∞—î `Group`
* shape **–ù–ï –ø–æ–≤–∏–Ω–Ω–∞ –∑–Ω–∞—Ç–∏** –ø—Ä–æ drag, selection, menu
  ‚Üí —Ü–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å `DiagramSymbols`

---

## 6Ô∏è‚É£ –Ø–∫ —Ç–µ–ø–µ—Ä –≤–∏–≥–ª—è–¥–∞—î `DiagramSymbols.js` (–∫–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç)

### ‚ùå –ë—É–ª–æ

```js
import GraphLibrary from './../graph'
```

### ‚úÖ –°—Ç–∞–ª–æ

```js
import { ShapeRegistry } from "@/shared/diagram/shapes";
```

–Ü —Ä–µ–Ω–¥–µ—Ä:

```js
const Shape = ShapeRegistry[el.type];
if (!Shape) return null;

return (
  <Group ...>
    <Shape el={el} />
    ...
  </Group>
);
```

‚úî –¢–µ–ø–µ—Ä:

* `DiagramSymbols` **–Ω–µ –∑–Ω–∞—î**, —â–æ —Ç–∞–∫–µ Rect/Circle
* –≤—ñ–Ω –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ `type`
* shapes –ª–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ / –∑–∞–±–æ—Ä–æ–Ω—è—Ç–∏

---

## 7Ô∏è‚É£ –í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ —Ç–≤–æ—î –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ `node`

> *¬´–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è node, –ø—ñ–¥ node —è —Ä–æ–∑—É–º—ñ—é —Ä—ñ–∑–Ω—ñ —Ñ—ñ–≥—É—Ä–∏¬ª*

‚úî –¢–∏ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥—á—É–≤**, —â–æ `node` ‚Äî –ø–æ–≥–∞–Ω–∞ –Ω–∞–∑–≤–∞.

### ‚ùå –ù–ï –≤–∞—Ä—Ç–æ

* `node` ‚Äî Konva-—Ç–µ—Ä–º—ñ–Ω
* `node` ‚Äî DOM-—Ç–µ—Ä–º—ñ–Ω
* `node` ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º—ñ—á–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω

### ‚úÖ –ö—Ä–∞—â–µ

| –ö–æ–Ω—Ç–µ–∫—Å—Ç  | –ù–∞–∑–≤–∞                              |
| --------- | ---------------------------------- |
| –î–∞–Ω—ñ      | `shape`                            |
| Selection | `shapeId`                          |
| UI        | `selectedShape`                    |
| target    | `{ kind: "shape", shapeType, id }` |

üëâ –£ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º—É –º–µ–Ω—é:

```js
{ kind: "shape", id: el.id, shapeType: el.type }
```

---

## 8Ô∏è‚É£ –ü—ñ–¥—Å—É–º–æ–∫ ‚Äî —Ç–∏ —Ä–æ–±–∏—à **–¥—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É**

–£ —Ç–µ–±–µ –≤–∂–µ —î:

* feature-scoped editor
* shared konva infra
* registry shapes
* state —ñ–∑ —á—ñ—Ç–∫–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—é

üëâ –¶–µ **–º–∞–π–∂–µ FSD + editor-engine**.

---

## –©–æ –ø—Ä–æ–ø–æ–Ω—É—é –¥–∞–ª—ñ

–ù–∞—Å—Ç—É–ø–Ω—ñ –ª–æ–≥—ñ—á–Ω—ñ –∫—Ä–æ–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ —á–µ—Ä–∑—ñ):

1Ô∏è‚É£ –ü—Ä–∏–≤–µ—Å—Ç–∏ **DiagramSymbols** –¥–æ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ—ó —á–∏—Å—Ç–æ—ó –≤–µ—Ä—Å—ñ—ó
2Ô∏è‚É£ –í–≤–µ—Å—Ç–∏ **shape schema** (`width/height/radius`) —è–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
3Ô∏è‚É£ –†–æ–∑–¥—ñ–ª–∏—Ç–∏ `useDiagramState` –Ω–∞:

* `useDiagramStore`
* `useConnectionRouting`
* `useSelection`

üëâ –°–∫–∞–∂–∏, –∑ —á–æ–≥–æ –π–¥–µ–º–æ –¥–∞–ª—ñ ‚Äî **DiagramSymbols** —á–∏ **useDiagramState**.
